<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:align-items="http://www.w3.org/1999/xhtml">
<head>
<meta charset="UTF-8" th:replace="~{body/headEmployee :: head}" />
<title>main</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
	rel="stylesheet" />
<!-- Font Awesome -->
<link
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css"
	rel="stylesheet" />
<!-- FullCalendar CSS -->
<link
	href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css"
	rel="stylesheet" />
<style>
body {
	font-family: "Arial", sans-serif;
	margin: 0;
	padding-top: 80px;
	/* Header height */
	padding-left: 80px;
	/* Shift left by another 50px from previous 130px */
	background-color: #fff3e0 !important;
	box-sizing: border-box;
}

.container {
	display: grid;
	grid-template-columns: 500px 1.5fr 200px;
	/* Make second column wider */
	grid-template-rows: auto auto 1fr;
	gap: 20px;
	height: calc(100vh - 80px);
	/* Full height minus header */
	padding: 20px;
	box-sizing: border-box;
	transform: translateX(-50px);
	/* Shift left by 50px */
}

/* 日曆區域 */
.calendar {
	background-color: #f8d8a4 !important;
	grid-column: 1/2;
	grid-row: 1/3;
	border: 1px solid #dee2e6;
	border-radius: 5px;
	padding: 10px;
	background-color: #f8f9fa;
	width: 100%;
	height: 500px;
	box-sizing: border-box;
	overflow: hidden;
	display: flex;
	justify-content: center;
	align-items: center;
}

#miniViewContainer {
	width: 100%; /* 讓容器寬度為100% */
	height: auto; /* 高度設為100%以填滿父容器 */
	padding: 1px;
	margin: 0;
}

/* 請假單狀態與請假按鈕 */
.leave-status {
    grid-column: 1/3;
    grid-row: 4/5;
    width: 100%; /* 讓寬度自適應父容器 */
    max-width: 700px; /* 設置最大寬度為 700px */
    background-color: #f8f9fa;
    padding: 5px;
    border-radius: 5px;
    height: 300px; /* 固定高度以便顯示滾動條 */
    box-sizing: border-box;
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* 將內容對齊到頂部 */
    align-items: stretch; /* 讓內部元素撐滿寬度 */
    position: relative;
    overflow: hidden;
}


.waitStatus {
	width: 100%; /* 讓寬度佔滿容器 */
	height: 100%; /* 讓高度佔滿容器 */
	overflow-y: auto; /* 垂直滾動條 */
	padding: 5px; /* 增加內邊距 */
	box-sizing: border-box; /* 包含內邊距和邊框 */
}

.leave-status p {
	margin: 0 0 10px 0;
}

.leave-status button {
	flex: 1;
	height: 50px;
	/* 統一按鈕高度 */
}

/* 待進貨項目 */
.pending-restock {
	grid-column: 2/3;
	grid-row: 1/2;
	border: 1px solid #dee2e6;
	border-radius: 5px;
	padding: 10px;
	background-color: #f8f9fa;
	max-height: 250px;
	overflow-y: auto;
	box-sizing: border-box;
}

/* 結帳按鈕、退貨按鈕與查詢會員紅利按鈕 */
.checkout-buttons {
	grid-column: 2/3;
	grid-row: 2/3;
	display: flex;
	flex-direction: column;
	gap: 10px;
	box-sizing: border-box;
	margin-top: 30px;
	/* Move downward */
}

/* 進貨單按鈕與匯出 Excel 按鈕 */
.restock-excel-buttons {
	grid-column: 3/4;
	grid-row: 1/3;
	display: flex;
	flex-direction: column;
	gap: 15px;
	box-sizing: border-box;
}

/* 會員按鈕 */
.member-button {
	grid-column: 3/4;
	grid-row: 3/4;
	box-sizing: border-box;
	display: flex;
	align-items: center;
	justify-content: center;
}

/* 自訂按鈕樣式 */
.btn-custom {
	width: 100%;
	padding: 10px;
	font-size: 16px;
	height: 50px;
	/* 統一按鈕高度 */
}

.btn-bonus {
	background-color: yellow;
	color: black;
	width: 100%;
	padding: 15px;
	font-size: 18px;
	border: 2px solid #ccc;
	text-align: center;
	height: 50px;
	/* 統一按鈕高度 */
}

/* 圖片樣式 */
.restock-excel-buttons img {
	width: 200px;
	/* 設定圖片寬度為200px */
	height: auto;
	object-fit: contain;
	align-self: center;
	/* 圖片居中 */
}

/* 日期選擇器 */
.date-picker {
	display: flex;
	flex-direction: column;
	gap: 10px;
}

.date-picker label {
	margin-bottom: 5px;
}

.date-inputs {
	display: flex;
	gap: 10px;
}

.date-inputs .form-control {
	flex: 1;
}

.restock-excel-buttons button {
	width: 100%;
	height: 50px;
	/* 統一按鈕高度 */
}

@media ( max-width : 1200px) {
	.container {
		grid-template-columns: 1fr;
		grid-template-rows: repeat(6, auto);
		padding: 10px;
		transform: none;
		/* Remove transform for small screens */
	}
	.calendar {
		grid-column: 1/-1;
		width: 100%;
		height: 400px;
	}
	.leave-status, .pending-restock, .checkout-buttons,
		.restock-excel-buttons, .member-button {
		grid-column: 1/-1;
		width: 100%;
	}
	.restock-excel-buttons img {
		width: 100%;
	}
}
</style>
</head>

<body>
	<div th:replace="~{body/headerEmployee :: headerEmployee}">
		<div th:fragment="content">
			<div class="container">
				<input type="hidden" id="employeeId"
					th:value="${session.employee.employeeId}" />
				<!-- 左上：排班月曆 -->
				<div class="calendar">
					<div id="miniViewContainer"></div>
				</div>
				<!-- 中上：待進貨 -->
				<div class="pending-restock">
					<h3>待進貨項目</h3>
					<p>項目 1</p>
					<p>項目 2</p>
					<!-- 添加更多項目以測試滾動 -->
				</div>

				<!-- 左下：請假單狀態與請假按鈕 -->
				<div class="leave-status">
					<div id="waitStatus" class="waitStatus"></div>
				</div>


				<!-- 中下：結帳按鈕、退貨按鈕與查詢會員紅利按鈕 -->
				<div class="checkout-buttons">
					<button class="btn btn-primary btn-custom">結帳</button>
					<button class="btn btn-danger btn-custom">退貨</button>
					<!-- 查詢會員紅利 -->
					<button class="btn-bonus">查詢會員紅利</button>
				</div>

				<!-- 右上：進貨單按鈕與匯出 Excel 按鈕 -->
				<div class="restock-excel-buttons">
					<!-- 進貨單按鈕 -->
					<img th:src="@{/img/購物車.png}" alt="無法顯示" />
					<button id="addRestock" class="btn btn-success btn-custom">
						新增進貨單</button>
					<!-- 日期選擇器 -->
					<div class="date-picker">
						<label>選擇日期範圍：</label>
						<div class="date-inputs">
							<div>
								<label for="start-date">開始日期：</label> <input type="date"
									id="start-date" class="form-control" />
							</div>
							<div>
								<label for="end-date">結束日期：</label> <input type="date"
									id="end-date" class="form-control" />
							</div>
						</div>
					</div>
					<img th:src="@{/img/下載.png}" alt="無法顯示2" />
					<!-- 匯出 Excel 按鈕 -->
					<button id="exportExcel" class="btn btn-info btn-custom">
						匯出進貨明細Excel</button>
				</div>

				<!-- 右下：會員按鈕 -->
				<div class="member-button">
					<button class="btn btn-secondary btn-custom">會員管理</button>
				</div>
			</div>
		</div>
	</div>
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	<!-- FullCalendar JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js"></script>
	<!-- Bootstrap JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	<script>
      document.addEventListener("DOMContentLoaded", function () {
        function loadMiniView() {
          const employeeId = document.getElementById("employeeId").value;

          const url = `/marketMaster/schedules/miniView?id=${employeeId}`;
          axios
            .get(url)
            .then((response) => {
              document.getElementById("miniViewContainer").innerHTML =
                response.data;
            })
            .catch((error) => {
              console.error("無法加載 miniView:", error);
            });
        }

        loadMiniView();
      
       function loadwaitStatus() {
          const employeeId = document.getElementById("employeeId").value;

          const url = `/marketMaster/askForLeave/waitStatus?id=${employeeId}`;
          axios
            .get(url)
            .then((response) => {
              document.getElementById("waitStatus").innerHTML =
                response.data;
            })
            .catch((error) => {
              console.error("無法加載 miniView:", error);
            });
        }

        loadwaitStatus();
      });

      document
        .getElementById("addRestock")
        .addEventListener("click", function () {
          window.location.href = "/marketMaster/restock/restockInsert";
        });

      document
        .getElementById("exportExcel")
        .addEventListener("click", function () {
          var startDate = document.getElementById("start-date").value;
          var endDate = document.getElementById("end-date").value;

          if (!startDate || !endDate) {
            alert("請選擇匯出的開始日期和結束日期。");
            return;
          }

          if (startDate > endDate) {
            alert("開始日期不能晚於結束日期。");
            return;
          }

          console.log("匯出 Excel 的日期範圍:", startDate, "至", endDate);
          axios
            .get("/marketMaster/restockDetail/getExcelByDateRange", {
              params: {
                startDate: startDate,
                endDate: endDate,
              },
              responseType: "blob",
            })
            .then((res) => {
              const blob = new Blob([res.data], {
                type: "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
              });
              const downloadUrl = window.URL.createObjectURL(blob);
              const a = document.createElement("a");

              a.href = downloadUrl;
              a.download = `進貨明細_${startDate}_至_${endDate}.xlsx`; // 設置下載的文件名
              document.body.appendChild(a);
              a.click();
              document.body.removeChild(a);

              // 釋放 URL 物件
              window.URL.revokeObjectURL(downloadUrl);
            })
            .catch((error) => {
              console.error("匯出失敗", error);
              alert("匯出失敗，請檢查日期範圍並重試。");
            });
        });
    </script>
</body>
</html>
