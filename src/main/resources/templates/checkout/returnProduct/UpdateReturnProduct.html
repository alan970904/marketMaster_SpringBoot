<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" th:replace="~{body/head :: head}">
    <title>更新退貨資訊</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;500;600;700&display=swap" rel="stylesheet">
    
</head>
<body>
<div th:replace="~{body/header :: header}">
    <div th:fragment="content">
        <div class="container mt-5" role="main">
            <h1 class="mb-4">更新退貨資訊</h1>

            <div class="card">
                <div class="card-body">
                    <form id="updateReturnProductForm">
                        <div class="mb-3">
                            <label for="returnId">退貨編號:</label>
                            <input type="text" class="form-control" th:value="${returnProduct.returnId}" readonly>
                        </div>
                        
                        <div class="mb-3">
                            <label for="originalInvoiceNumber">發票號碼:</label>
                            <input type="text" class="form-control" id="originalInvoiceNumber" name="originalInvoiceNumber" th:value="${returnProduct.originalInvoiceNumber}" readonly>
                        </div>
                        
                        <div class="mb-3">
                            <label for="checkoutId">結帳編號:</label>
                            <input type="text" class="form-control" id="originalCheckoutId" name="originalCheckoutId" th:value="${returnProduct.originalCheckoutId}" readonly>
                        </div>
                        
                        <div class="form-group">
                            <label for="employeeId">員工編號:</label>
                            <select id="employeeId" name="employeeId" class="form-control" required>
        						<option value="">請選擇員工</option>
        						<option th:each="emp : ${employees}" 
                						th:value="${emp.employeeId}" 
                						th:text="${emp.employeeId + ' - ' + emp.employeeName}">
        						</option>
    						</select>
                        </div>

						<div class="mb-3">
                            <label for="returnTotalPrice">退貨總金額:</label>
                            <input type="number" class="form-control" id="returnTotalPrice" name="returnTotalPrice" th:value="${returnProduct.returnTotalPrice}" readonly>
                        </div>
						
                        <div class="mb-3">
                            <label for="returnDate">退貨日期:</label>
                            <input type="date" class="form-control" id="returnDate" name="returnDate" th:value="${#dates.format(returnProduct.returnDate, 'yyyy-MM-dd')}" required>
                        </div>


                        <button type="submit" class="btn btn-primary">更新</button>
                    </form>
                </div>
            </div>

            <a class="btn btn-secondary mt-3" th:href="@{/returnProduct/list}">返回退貨列表</a>
        </div>
    </div>
</div>
<div th:replace="~{body/footer :: footer}"></div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
$(document).ready(function() {
    $("#updateBtn").click(function() {
        const updateData = {
            returnId: $("[th:value='${returnProduct.returnId}']").val(),
            employeeId: $("#employeeId").val(),
            returnDate: $("#returnDate").val()
        };

        axios.post('/returnProduct/update', updateData)
            .then(response => {
                if(response.data.status === 'success') {
                    alert('更新成功');
                    window.location.href = '/returnProduct/list';
                }
            })
            .catch(error => alert('更新失敗: ' + error.response.data.message));
    });
});
</script>
</body>
</html>